=====================================================================
STAGE 0 — БАЗОВАЯ СТРУКТУРА ПРОЕКТА
=====================================================================

Зависимости: нет (стартовая точка)

[ ] Проверить корректность структуры apps [ ] Убедиться, что CustomUser
используется корректно [ ] Проверить миграции и целостность БД [ ]
Настроить .env [ ] Разделить dev / prod конфигурацию (заготовка)

Результат: Проект чистый, управляемый и предсказуемый.

=====================================================================
STAGE 1 — ФИНАНСОВАЯ БЕЗОПАСНОСТЬ (КРИТИЧНО)
=====================================================================

Зависит от: Stage 0

1.1 Денежная целостность

[ ] Все денежные поля = DecimalField [ ] Нет float [ ] Добавить
валидацию отрицательных значений [ ] Добавить проверки бизнес-правил в
сервисный слой

1.2 Конкурентность

[ ] Вынести сложные операции в services/ [ ] Использовать
@transaction.atomic [ ] Использовать select_for_update() при
необходимости

1.3 Индексы

[ ] Индекс на user [ ] Индекс на transaction_date [ ] Индекс на
created_at [ ] Composite индекс (user, transaction_date)

Результат: Нет race condition, нет логических расхождений.

=====================================================================
STAGE 2 — АРХИТЕКТУРНАЯ ЧИСТОТА
=====================================================================

Зависит от: Stage 1

[ ] Создать папку services/ в finance [ ] Перенести бизнес-логику из
serializers в services [ ] View → вызывает service [ ] Serializer →
только валидирует [ ] Добавить core/ (общие миксины, idempotency, utils)

Дополнительно: [ ] Подготовить idempotency middleware (заготовка)

Результат: Проект готов к масштабированию.

=====================================================================
STAGE 3 — AI И ФОНОВЫЕ ЗАДАЧИ
=====================================================================

Зависит от: Stage 2

3.1 Инфраструктура

[ ] Подключить Redis [ ] Подключить Celery [ ] Настроить broker и
backend

3.2 Перенос AI в background

[ ] Создать Celery task для AI [ ] Endpoint возвращает task_id [ ]
Отдельный endpoint для получения статуса [ ] Ограничить retries и
добавить backoff

3.3 История AI

[ ] Убрать RAM-хранилище [ ] Хранить историю в БД или Redis [ ]
Ограничить размер истории

Результат: AI не блокирует API, система устойчива.

=====================================================================
STAGE 4 — DASHBOARD И АГРЕГАЦИИ
=====================================================================

Зависит от: Stage 1

[ ] Создать единый endpoint /dashboard/ [ ] Считать агрегаты через
annotate [ ] Добавить Redis cache (30–60 сек) [ ] Инвалидировать cache
при создании транзакции

Результат: Frontend получает все данные одним запросом.

=====================================================================
STAGE 5 — FRONTEND FOUNDATION
=====================================================================

Зависит от: Stage 4 (желательно)

5.1 Архитектура

[ ] React + TypeScript [ ] Структура: - api/ - features/ - components/ -
hooks/ - pages/

5.2 Data Layer

[ ] TanStack Query [ ] staleTime = 30s [ ] refetchOnWindowFocus = false
[ ] invalidateQueries после мутации

5.3 Авторизация

[ ] Axios instance [ ] Interceptor 401 → refresh → retry [ ] Access
token в памяти [ ] Refresh token в HttpOnly cookie

Результат: SPA корректно управляет состоянием и авторизацией.

=====================================================================
STAGE 6 — ПРОИЗВОДИТЕЛЬНОСТЬ
=====================================================================

Зависит от: Stage 3 и Stage 4

[ ] select_related [ ] prefetch_related [ ] only / defer при
необходимости [ ] Проверить EXPLAIN ANALYZE [ ] Настроить Gunicorn
workers [ ] Ограничить timeout [ ] Rate limit на уровне Nginx

Результат: Система выдерживает умеренную нагрузку.

=====================================================================
STAGE 7 — SECURITY HARDENING
=====================================================================

Зависит от: Stage 1

[ ] DEBUG=False [ ] ALLOWED_HOSTS ограничен [ ] HTTPS [ ] HSTS [ ]
Secure cookies [ ] CSRF protection [ ] django-cors-headers [ ]
Логирование user_id + request_id [ ] Audit log для транзакций

Результат: Система production-ready по безопасности.

=====================================================================
STAGE 8 — DEPLOYMENT
=====================================================================

Зависит от: Stage 6 и Stage 7

8.1 Docker

[ ] Dockerfile backend [ ] docker-compose: - web - postgres - redis -
celery - celery-beat - nginx

8.2 Прод-конфигурация

[ ] Отдельный production settings [ ] Статические файлы через Nginx [ ]
.env вне репозитория [ ] Проверка health endpoint

Результат: Проект можно разворачивать на сервере.

=====================================================================
STAGE 9 — ПОДГОТОВКА К ЗАЩИТЕ
=====================================================================

Зависит от: Все предыдущие

[ ] Swagger документация финализирована [ ] ER-диаграмма [ ] Диаграмма
последовательности AI [ ] Раздел “Безопасность данных” [ ] Раздел
“Масштабирование” [ ] Описание архитектурных решений

Результат: Проект выглядит как зрелая инженерная система.

=====================================================================
ПОСЛЕДОВАТЕЛЬНОСТЬ ВНЕДРЕНИЯ
=====================================================================

0 → 1 → 2 → 3 → 4 → 5 → 6 → 7 → 8 → 9

Критичные: Stage 1, 2, 3

Обязательные перед релизом: Stage 6, 7, 8

Для сильной защиты: Stage 9

=====================================================================
END OF DETAILED ROADMAP
=====================================================================
